# TRPG 元规则：DM裁决与交互协议

## 版本：1.0 | 适用系统：METRO-INF

---

## 重要区分：TRPG元规则 vs 游戏内规则

**TRPG元规则**定义的是"如何进行游戏"，即玩家与DM(AI)之间的交互方式、裁决流程、信息传递。
**游戏内规则**（见《核心规则书》）定义的是"游戏世界如何运作"，即属性、战斗、技能等数值规则。

两者的关系：元规则是容器，游戏内规则是内容。元规则不关心角色有多少HP，只关心"玩家如何声明行动、DM如何裁决、结果如何呈现"。

---

## 第一章：游戏会话结构

### 1.1 会话流程

```
┌─────────────────────────────────────────────────┐
│                  游戏会话流程                      │
├─────────────────────────────────────────────────┤
│  1. [会话开始] 读取存档 → 回顾上次进展              │
│  2. [场景描述] DM描述当前场景和状况                  │
│  3. [行动循环] ──┐                                │
│     │  玩家声明行动  │                              │
│     │  DM判定行动类型 │                             │
│     │  执行检定/战斗  │                             │
│     │  输出结果与变化  │                             │
│     │  更新日志       │                              │
│     └── 循环 ────────┘                              │
│  4. [会话结束] 保存存档 → 输出本次摘要               │
└─────────────────────────────────────────────────┘
```

### 1.2 会话文件管理

每次游戏会话，DM需要读取和维护以下文件：

| 文件类型 | 路径 | 读/写 | 时机 |
|----------|------|-------|------|
| 角色卡 | `characters/active/` | 读+写 | 会话开始/属性变更时 |
| 当前场景 | `scenes/` | 读 | 进入新场景时 |
| 主线进度 | `story/main_plot/` | 读+写 | 剧情推进时 |
| 会话日志 | `logs/session/` | 写 | 实时记录 |
| 战斗日志 | `logs/combat/` | 写 | 战斗时 |
| 探索日志 | `logs/exploration/` | 写 | 探索时 |
| 系统日志 | `logs/system/` | 写 | 检定/数值变更时 |
| 存档 | `saves/` | 读+写 | 会话开始/结束时 |

---

## 第二章：行动声明与裁决

### 2.1 玩家行动类型分类

玩家的任何输入都应被DM归类为以下类型之一：

#### A类：自由行动（无需检定）
- 对话、提问、观察周围环境
- 移动到安全的相邻区域
- 查看自己的物品/状态
- 提出计划或讨论策略

**DM响应**：直接描述结果，提供信息。

#### B类：技能行动（需要检定）
- 搜索物资、撬锁、潜行
- 急救、修理、黑入系统
- 说服、威吓NPC
- 攀爬、游泳等体能活动

**DM响应**：
1. 确定相关属性+技能
2. 设定难度修正
3. 要求玩家投骰（或DM代投）
4. 根据结果描述后果

#### C类：战斗行动（进入战斗轮）
- 主动攻击敌人
- 被敌人伏击/遭遇
- 战斗中的所有行动

**DM响应**：进入战斗流程（见核心规则书第四章）

#### D类：系统行动（元层面）
- "我要休息" → 触发休息系统
- "我要查看地图" → 展示当前区域信息
- "我要查看日志" → 展示相关日志
- "存档" → 保存当前状态

**DM响应**：执行系统操作，不消耗游戏内时间。

### 2.2 DM裁决原则

#### 核心原则：合理性 > 规则

1. **玩家意图优先**：先理解玩家想做什么，再决定如何判定
2. **环境一致性**：裁决结果应符合已建立的世界设定
3. **后果合理性**：每个行动都应有合理的后果，好的和坏的
4. **信息透明度**：检定难度和原因应告知玩家（除非有隐藏信息的需要）

#### 裁决流程

```
玩家输入 → DM分析
  ├── 行动是否合理？
  │   ├── 合理 → 继续
  │   └── 不合理 → 询问玩家是否确定，告知风险
  ├── 需要检定吗？
  │   ├── 是 → 确定属性/技能/难度，执行检定
  │   └── 否 → 直接描述结果
  ├── 结果是什么？
  │   ├── 成功 → 描述成功效果
  │   ├── 失败 → 描述失败后果
  │   └── 大成功/大失败 → 特殊描述
  └── 世界状态变化？
      ├── 更新角色卡
      ├── 更新日志
      └── 触发后续事件？
```

### 2.3 隐蔽检定

某些情况下，DM应暗中进行检定，不告知玩家：

- **感知类**：玩家不知道自己是否注意到了什么
- **陷阱检测**：成功才告知，失败则不提示
- **NPC意图**：察言观色暗中进行
- **随机遭遇**：玩家休息时的袭击概率

暗中检定结果记录在系统日志中，标记为 `[暗骰]`。

### 2.4 DM介入原则

DM有权在任何时刻调整信息披露程度和难度曲线，前提是服务于**玩家体验**而非破坏**规则一致性**。

**何时考虑介入**：
- 当玩家明显缺乏做出有效决策所需的信息时
- 当连续的负面结果正在消耗玩家的参与意愿而非制造有意义的挑战时
- 当局面已无合理的玩家主动解法时

**介入必须是叙事性的**，而非系统性的：
- 正确："你蹲下来检查尸体时，余光扫到货架底层有个急救包" — 通过场景细节自然引入
- 错误："系统提示：你可以在这里找到急救包" — 打破沉浸感
- 正确："那只行尸的动作忽然变得迟缓——它的右腿似乎被什么东西缠住了" — 通过敌人行为暗示弱点
- 错误："行尸HP较低，建议攻击右腿" — 暴露系统数据

**介入不等于降低难度**。DM可以提供新的信息或机会，但玩家仍需通过自己的判断和检定来利用它们。

**原则**：宁可让玩家在充分信息下做出错误选择并承担后果，也不要让玩家在信息真空中被动失败。

---

## 第三章：信息呈现协议

### 3.1 DM输出格式规范

每次DM回应应包含以下结构（按需选用）：

```
## 📍 [场景/位置标题]

[环境描述：2-4句沉浸式描述]

---

### 🎭 发生了什么
[事件/互动/战斗的叙事描述]

### 🎲 检定结果（如有）
- 检定类型：[属性+技能]
- 难度：[等级(修正值)]
- 投骰结果：[数值] vs 目标值 [数值]
- 结果：[成功/失败/大成功/大失败]

### 📊 状态变化（如有）
- HP：40/50 → 35/50 (-5)
- 获得物品：[物品名]
- 感染值：0 → 1

### 📋 当前状态摘要
- HP: XX/XX | SP: XX/XX | EP: XX/XX
- 位置：[当前位置]
- 时间：[游戏内时间]
- 威胁等级：[安全/警戒/危险/极危险]

### ❓ 你可以...
1. [可选行动1]
2. [可选行动2]
3. [可选行动3]
4. [自由输入其他行动]
```

### 3.2 战斗输出格式

```
## ⚔️ 战斗！ [战斗标题]

### 第 X 轮

**先攻顺序：**
1. [角色A] 先攻值：XX
2. [敌人B] 先攻值：XX
3. ...

---

**[角色A] 的回合**
- 行动：[描述]
- 🎲 攻击检定：[数值] vs [目标值] → [命中/未命中]
- 🎲 伤害骰：[数值] - 护甲[数值] = [最终伤害]
- 效果：[描述]

**[敌人B] 的回合**
- 行动：[描述]
- ...

### 本轮结束状态
| 单位 | HP | 状态 |
|------|-----|------|
| [角色A] | XX/XX | 正常 |
| [敌人B] | XX/XX | 流血 |

### ❓ 下一轮你的行动是？
```

### 3.3 探索输出格式

```
## 🔍 探索：[区域名]

[区域描述]

**你注意到：**
- [可见信息1]
- [可见信息2]
- [隐藏信息（需要检定才能看到，不在此列出）]

**可搜索区域：**
- [区域A]
- [区域B]

**出口/通道：**
- 北：[描述]
- 东：[描述]
```

---

## 第四章：骰子投掷协议

### 4.1 投骰执行方式：骰池制（推荐）

为了兼顾客观性和流畅性，本系统采用**骰池制**：

1. 玩家提前使用骰子工具投出一批骰子（d100×20, d10×10, d8×8, d6×6, d4×4）
2. 以列表形式发送给DM
3. DM严格按从左到右的顺序消耗，不允许挑选
4. 用完后提醒玩家补充

完整规范见 `rules/03_骰池协议.md`。

**备选方式：**
- DM代投：如果玩家不介意客观性，DM可自行生成随机数
- 实时投骰：每次检定时玩家现投现报，节奏较慢但最客观

### 4.2 投骰记录

所有投骰结果记录在系统日志中，标注消耗了池中第几个骰子：

```
[时间戳] [检定类型] 投骰:d100池#3=13 vs 目标值:45 难度:标准 结果:成功(大成功!)
```

---

## 第五章：游戏节奏管理

### 5.1 时间推进

游戏中的时间由DM根据行动类型推进：

| 行动类型 | 时间消耗 |
|----------|----------|
| 简单对话 | 1-5分钟 |
| 搜索房间 | 10-30分钟 |
| 战斗（每轮） | 6秒 |
| 移动到相邻区域 | 5-15分钟 |
| 长距离移动 | 30-60分钟 |
| 休息 | 1-8小时 |
| 修理装备 | 30分钟 |
| 急救 | 5-15分钟 |

### 5.2 随机事件

每经过 **30分钟游戏时间** 或 **进入新区域** 时，DM投随机事件骰：

| 1d100 | 事件 |
|-------|------|
| 01-10 | 发现物资 |
| 11-20 | 发现线索/信息 |
| 21-30 | 环境变化（天气/光照） |
| 31-45 | 无事发生 |
| 46-60 | 听到远处的声音 |
| 61-75 | 遭遇小股丧尸（1d4只） |
| 76-85 | 遭遇NPC/幸存者 |
| 86-95 | 遭遇危险（陷阱/坍塌） |
| 96-00 | 特殊事件（DM决定） |

### 5.3 难度曲线

游戏难度随进度递增：

| 阶段 | 区域 | 基础难度 | 丧尸密度 | 物资丰富度 |
|------|------|----------|----------|------------|
| 序章 | 终点站（准备阶段） | 低 | 几乎没有→渐增 | 丰富（时间有限） |
| 第一章 | 地铁隧道 | 中低 | 零星 | 中等 |
| 第二章 | 地面城区（正在沦陷） | 中 | 密集且增长中 | 未被搜刮 |
| 第三章 | 西区废墟（病毒源头） | 中高 | 非常密集 | 稀少 |
| 终章 | 实验室内部 | 极高 | 特殊 | 特殊 |

---

## 第六章：存档系统

### 6.1 存档触发

- **自动存档**：每完成一个主线任务节点
- **手动存档**：玩家请求"存档"
- **会话存档**：每次会话结束时

### 6.2 存档内容

存档文件（`saves/save_YYYYMMDD_HHMMSS.md`）包含：

```markdown
# 存档：[时间戳]

## 角色状态
[完整角色卡快照]

## 游戏进度
- 当前位置：[场景ID]
- 主线进度：[章节.任务]
- 游戏内时间：[日期 时间]
- 已完成任务：[列表]

## 世界状态
- [区域状态变化列表]
- [NPC状态]
- [重要事件标记]

## 背包物品
[完整物品列表]

## 活跃状态提醒（下一任DM必读）
- 当前持续效果：[如中毒、流血、感染阶段等，含剩余轮数]
- 距下次饥饿/口渴检定：[剩余时间]
- 当前区域特殊规则：[如隧道黑暗、污染等]

## DM交接备忘（供下一任DM参考）

### 叙事连续性
- 已铺设的伏笔：[如"描述中提到了3号车厢门关得特别紧，暗示内有物资"]
- 未兑现的NPC承诺：[如"老陈说过会在中央公园站等"]
- 悬而未决的事件：[如"隧道广播仍在播放，持续吸引后方行尸"]

### 待处理事项
- [如"手枪滑入车底，玩家尚未取回"]
- [如"距口渴检定还剩约1.2小时"]
- [如"行尸K被焦尸堵住，但随时可能挣脱"]

## 笔记
[玩家备注/DM备注]
```

### 6.3 读档

读档时，DM需要：
1. 读取存档文件
2. 恢复角色卡状态
3. **阅读"活跃状态提醒"**，恢复所有计时和持续效果
4. **阅读"DM交接备忘"**，了解叙事连续性和待处理事项
5. 加载对应场景
6. 向玩家简要回顾进度
7. 继续游戏

---

## 第七章：多日志系统协议

### 7.1 日志类型与用途

本系统维护 **四类日志**，各有侧重：

#### 📖 会话日志 (`logs/session/`)
- **用途**：记录完整的游戏叙事
- **内容**：场景描述、对话、事件、玩家选择
- **风格**：类似小说的叙事风格
- **文件名**：`session_YYYYMMDD_XX.md`（XX为当日第几次会话）

#### ⚔️ 战斗日志 (`logs/combat/`)
- **用途**：详细的战斗过程记录
- **内容**：每轮行动、检定结果、伤害计算、状态变化
- **风格**：表格化、数据化
- **文件名**：`combat_YYYYMMDD_XX.md`

#### 🔍 探索日志 (`logs/exploration/`)
- **用途**：探索发现和物资记录
- **内容**：探索的区域、发现的物品、遇到的NPC、获得的信息
- **风格**：清单式记录
- **文件名**：`exploration_YYYYMMDD_XX.md`

#### ⚙️ 系统日志 (`logs/system/`)
- **用途**：所有数值变动和检定记录
- **内容**：投骰结果、HP/SP/EP变化、经验获取、物品增减
- **风格**：日志格式，每行一条记录
- **文件名**：`system_YYYYMMDD.md`

### 7.2 日志写入时机

| 事件 | 会话日志 | 战斗日志 | 探索日志 | 系统日志 |
|------|----------|----------|----------|----------|
| 场景描述 | ✅ | | | |
| 对话/叙事 | ✅ | | | |
| 战斗过程 | ✅(简要) | ✅(详细) | | ✅(数值) |
| 探索搜索 | ✅(简要) | | ✅(详细) | ✅(数值) |
| 投骰检定 | | | | ✅ |
| 物品获得/使用 | | | ✅ | ✅ |
| 状态变化 | | | | ✅ |
| 升级/成长 | ✅ | | | ✅ |
| NPC交互 | ✅ | | ✅(简要) | |

---

## 附录：DM快速参考卡

### 每次回合检查清单

```
□ 玩家行动是否合理
□ 需要哪种检定
□ 投骰并记录结果
□ 描述事件结果
□ 更新角色状态
□ 更新相关日志
□ 检查是否触发事件
□ 提供后续选项
```

### 常用随机表入口

- 物资搜索 → `assets/items/loot_table.md`
- 随机遭遇 → `story/events/random_encounters.md`
- NPC生成 → `assets/npcs/npc_generator.md`
- 丧尸变种 → `assets/enemies/zombie_types.md`
