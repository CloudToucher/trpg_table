# 骰池协议

## 核心思路

玩家提前投一批骰子，以列表形式交给DM。DM按顺序消耗这些结果，不需要每次检定都暂停等待。用完了再让玩家投一批新的。

**好处：** 骰子结果由玩家生成（客观公正），DM可以一口气处理完整轮行动（流畅不卡顿）。

---

## 骰池生成

### 方法：运行 Python 脚本

项目自带骰池生成工具 `tools/dice_pool.py`：

```bash
python tools/dice_pool.py          # 标准骰池，输出到控制台
python tools/dice_pool.py -o       # 标准骰池，写入 tools/dice_pool.md
python tools/dice_pool.py -l       # 大号骰池（数量翻倍）
python tools/dice_pool.py -o -l    # 大号骰池写入文件
python tools/dice_pool.py -o -a    # 追加到已有骰池文件（不覆盖）
```

生成后将输出内容（或 `tools/dice_pool.md` 的内容）发送给DM即可。

### 骰池格式

```
【骰池补充】 生成时间：2026-02-25 23:21:08

d100: 98, 21, 19, 77, 78,  7, 73, 89, 45, 18, 80, 28, 28, 90, 15, 93, 63, 67, 20, 59, 58, 69, 74, 61, 25, 91, 35, 90, 94, 61
 d10: 7, 7, 1, 9, 1, 6, 3, 9, 4, 8, 9, 8, 3, 7, 10
  d8: 2, 6, 4, 7, 6, 5, 3, 4, 3, 6, 3, 1
  d6: 5, 1, 5, 4, 2, 3, 4, 6, 2, 3
  d4: 3, 1, 4, 1, 2, 2

共 73 个骰子。复制以上内容发送给DM即可。
```

### 标准骰池大小

| 骰子类型 | 标准数量 | 大号(-l) | 用途 |
|----------|----------|----------|------|
| d100 | 30个 | 60个 | 技能检定、攻击命中、闪避、感染检定等 |
| d10 | 15个 | 30个 | 先攻投骰、部分判定 |
| d8 | 12个 | 24个 | 中型武器伤害、部分异能 |
| d6 | 10个 | 20个 | 轻型武器伤害、丧尸数量、流血伤害 |
| d4 | 6个 | 12个 | 状态效果伤害、逃跑轮数 |

标准骰池（73个）大约够用 **5-8轮探索** 或 **2-3场中等战斗**。

---

## DM使用规则

### 消耗顺序

- 严格从左到右按顺序消耗，**不允许挑选**
- 每消耗一个骰子，在系统日志中标注使用了池中第几个

### 消耗记录格式

系统日志中的记录：
```
[检定] 搜索(PER) 基础值:45 投骰:d100池#3=13 结果:成功(大成功!)
[攻击] 李明→行尸A 近战 基础值:85 投骰:d100池#4=88 结果:未命中
[伤害] 消防斧 投骰:d10池#1=7 +STR(2) -护甲(0) =9
```

### 骰池状态追踪

DM在角色卡或系统日志中维护当前骰池剩余状态：

```
【骰池剩余】
d100: [已用5/20] 下一个=#6
d10:  [已用2/10] 下一个=#3
d8:   [已用1/8]  下一个=#2
d6:   [已用0/6]  下一个=#1
d4:   [已用0/4]  下一个=#1
```

### 骰池耗尽

当某种骰子剩余不足3个时，DM在回复末尾提醒玩家补充：

```
⚠ 骰池告急：d100剩余2个，d8已耗尽。请补充骰池。
```

玩家发送新的骰池列表后，DM将新数字追加到现有列表末尾。

---

## 多骰消耗规则

有些情况需要同时消耗多个骰子：

| 情况 | 消耗方式 |
|------|----------|
| 2d8伤害 | 连续消耗2个d8 |
| 1d100攻击 + 1d100闪避 | 连续消耗2个d100 |
| 先攻(1d10) | 消耗1个d10 |
| 3d6丧尸数量 | 连续消耗3个d6 |

---

## DM代投的补充情况

以下情况DM可以自行生成随机数，不消耗骰池：

- **暗骰**（玩家不知道自己在做检定的情况，如伏击感知、隐藏搜索）
- **敌人行为决策**（敌人选择攻击谁、是否逃跑等非数值判定）
- **随机事件投骰**（世界事件，与玩家行动无关）
- **掉落表投骰**（物资随机）

这些不影响公正性（不涉及玩家角色的成败判定），所以不需要消耗玩家的骰池。

---

## 快速开始

DM对玩家说：

> 游戏开始前，请运行骰池生成器：
> ```
> python tools/dice_pool.py -o
> ```
> 然后把 `tools/dice_pool.md` 的内容发给我（或者直接把控制台输出复制过来）。
> 我会按顺序使用这些骰子，用完了会提醒你再跑一次脚本补充。
