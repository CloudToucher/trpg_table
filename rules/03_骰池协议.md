# 骰池协议

## 核心思路

玩家提前投一批骰子，以列表形式交给DM。DM按顺序消耗这些结果，不需要每次检定都暂停等待。用完了再让玩家投一批新的。

**好处：** 骰子结果由玩家生成（客观公正），DM可以一口气处理完整轮行动（流畅不卡顿）。

---

## 骰池生成

### 方法：运行 Python 脚本

项目自带骰池生成工具 `tools/dice_pool.py`：

```bash
python tools/dice_pool.py          # 标准骰池，输出到控制台
python tools/dice_pool.py -o       # 标准骰池，写入 tools/dice_pool.md
python tools/dice_pool.py -l       # 大号骰池（数量翻倍）
python tools/dice_pool.py -o -l    # 大号骰池写入文件
python tools/dice_pool.py -o -a    # 追加到已有骰池文件（不覆盖）
```

生成后将输出内容（或 `tools/dice_pool.md` 的内容）发送给DM即可。

### 骰池格式

```
【骰池补充】 生成时间：2026-02-26 14:58:25

d100:
  30, 99, 48, 41, 81
  25, 65, 38, 32, 14
  91, 59, 58, 56,  6
  ...

d10:
  9, 3, 5, 9, 10
  10, 3, 9, 6, 6
  8, 7, 10, 6, 4

d8:
  7, 8, 8, 4, 8
  ...

d6:
  5, 2, 6, 4, 6
  ...

d4:
  3, 4, 2, 3, 3
  ...

共 102 个骰子。复制以上内容发送给DM即可。
```

> **重要**：AI每次消耗骰子后，**必须从骰池文件中删除该数字**（从左到右顺序删除）。

### 标准骰池大小

| 骰子类型 | 标准数量 | 大号(-l) | 用途 |
|----------|----------|----------|------|
| d100 | 50个 | 100个 | 技能检定、攻击命中、闪避、感染检定等 |
| d10 | 15个 | 30个 | 先攻投骰、部分判定、武器伤害 |
| d8 | 12个 | 24个 | 中型武器伤害、偷袭伤害、部分异能 |
| d6 | 15个 | 30个 | 轻型武器伤害、敌人数量、恢复效果 |
| d4 | 10个 | 20个 | 徒手伤害、状态效果、逃跑轮数 |

标准骰池（102个）大约够用 **8-12轮探索** 或 **3-5场中等战斗**。

---

## DM使用规则

### 消耗顺序

- 严格从左到右按顺序消耗，**不允许挑选**
- **每消耗一个骰子，必须从骰池文件中删除该数字**（划掉或删行）
- 每消耗一个骰子，在系统日志中标注使用了池中第几个

### 消耗记录格式

系统日志中的记录：
```
[检定] 搜索(PER) 基础值:45 投骰:d100池#3=13 结果:成功(大成功!)
[攻击] 李明→行尸A 近战 基础值:85 投骰:d100池#4=88 结果:未命中
[伤害] 消防斧 投骰:d10池#1=7 +STR(2) -护甲(0) =9
```

### 骰池状态追踪

DM在角色卡或系统日志中维护当前骰池剩余状态：

```
【骰池剩余】
d100: 已用10个，#11-50 剩余，下一个=#11
d10:  已用3个，#4-15 剩余，下一个=#4
d8:   已用2个，#3-12 剩余，下一个=#3
d6:   已用5个，#6-15 剩余，下一个=#6
d4:   已用1个，#2-10 剩余，下一个=#2
```

### 骰池耗尽

当某种骰子剩余不足3个时，DM在回复末尾提醒玩家补充：

```
⚠ 骰池告急：d100剩余2个，d8已耗尽。请补充骰池。
```

玩家发送新的骰池列表后，DM将新数字追加到现有列表末尾。

---

## 多骰消耗规则

有些情况需要同时消耗多个骰子：

| 情况 | 消耗方式 |
|------|----------|
| 2d8伤害 | 连续消耗2个d8 |
| 1d100攻击 + 1d100闪避 | 连续消耗2个d100 |
| 先攻(1d10) | 消耗1个d10 |
| 3d6丧尸数量 | 连续消耗3个d6 |

---

## DM代投的补充情况

以下情况DM可以自行生成随机数，不消耗骰池：

- **暗骰**（玩家不知道自己在做检定的情况，如伏击感知、隐藏搜索）
- **敌人行为决策**（敌人选择攻击谁、是否逃跑等非数值判定）
- **随机事件投骰**（世界事件，与玩家行动无关）
- **掉落表投骰**（物资随机）

这些不影响公正性（不涉及玩家角色的成败判定），所以不需要消耗玩家的骰池。

---

## 快速开始

DM对玩家说：

> 游戏开始前，请运行骰池生成器：
> ```
> python tools/dice_pool.py -o
> ```
> 然后把 `tools/dice_pool.md` 的内容发给我（或者直接把控制台输出复制过来）。
> 我会按顺序使用这些骰子，用完了会提醒你再跑一次脚本补充。
