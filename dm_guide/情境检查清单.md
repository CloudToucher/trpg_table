# 情境检查清单（防遗漏）

> 本文件不是规则本身，而是提醒列表。DM在处理对应场景时，逐条过一遍确保没有遗漏。
> 每条末尾标注了规则出处，需要细节时按路径查阅。

---

## A. 每轮通用清单（每次玩家行动后过一遍）

```
□ 行动是否消耗时间？→ 推进游戏内时钟
□ 是否产生噪音？→ 投噪音吸引骰（隧道内×2）        → rules/01 §6.2噪音表
□ 是否到了饥饿/口渴检定时间？（8h/6h计时）          → rules/01 §7.1
□ 角色是否有活跃负面状态？→ 结算持续效果             → rules/01 §4.4状态表
□ 是否已过30分钟或进入新区域？→ 投随机事件骰         → story/events/随机事件表.md
□ 角色卡是否需要更新？（HP/SP/EP/物品/位置变化）
□ 是否需要写入日志？→ 系统日志必写，其他日志按需
```

---

## B. 战斗进入清单（遭遇敌人、进入战斗时）

```
□ 确定敌人数据                                       → assets/enemies/丧尸图鉴.md
□ 是否有伏击？→ PER暗骰判定突袭                       → rules/01 §4.1
□ 所有参战者投先攻：AGI+PER+1d10，排列行动顺序
□ 确认战斗环境：光照、地形、掩体、可互动物体
□ 记录所有参战者的战前HP/SP/EP
□ 创建战斗日志文件                                    → logs/combat/
□ 确认当前区域噪音对丧尸吸引的影响
```

---

## C. 战斗每轮清单（每轮结束时）

```
□ 所有行动是否已按主要+次要+自由分类执行？             → rules/01 §4.2
□ 攻击检定是否正确？（1d100 vs 属性×10+技能×5+修正）
□ 防御方是否选择了闪避/格挡/不防御？
□ 伤害计算：武器骰+STR修正(近战)-护甲 ≥ 1
□ 被丧尸命中的角色→是否做了感染检定？（1d100 vs CON×10） → rules/01 §4.5
□ 武器/防具耐久是否扣减？（每次使用-1）                → rules/01 §6.5
□ 结算阶段：是否处理了所有持续效果？
   - 流血：-1d4HP
   - 中毒：-2HP且检定-5
   - 燃烧：按情况处理
□ 倒地角色是否被标记？（被近战+15，闪避-10）
□ 异能使用是否扣除SP？SP=0强行使用是否投了副作用骰？    → rules/01 §5.4
□ EP消耗：格挡/连续动作是否扣除EP？
□ 击杀是否记录经验值？                                → rules/01 §8.1
□ 更新战斗日志
```

---

## D. 探索/搜索清单（玩家搜索区域、探索房间时）

```
□ 确定区域类型→选择正确的掉落表                       → assets/items/物品与掉落表.md
□ 搜索检定：PER×10+搜索技能×5+难度修正
□ 根据检定结果级别决定掉落质量：
   - 大成功：投两次取好+额外稀有
   - 成功：正常投掉落表
   - 临界成功：物品数量-1
   - 失败：1件常见或空手
   - 大失败：触发陷阱/丧尸/噪音
□ 物品获得后→更新角色背包→检查负重是否超限
□ 时间推进10-30分钟
□ 搜索是否产生噪音？
□ 房间中是否有隐藏的丧尸？（按场景文件预设）
□ 记录到探索日志和系统日志
□ 是否有场景预设的特殊发现？                          → scenes/ 对应文件
```

---

## E. NPC交互清单（与NPC对话/交易时）

```
□ 查阅NPC数据：好感度、对话关键词、态度               → assets/npcs/NPC模板与列表.md
□ 玩家的话题是否匹配关键词？→ 给出对应信息
□ 是否涉及社交检定？（说服/威吓/察言观色）
□ 交易是否合理？（物品价值对等）
□ 好感度是否需要变化？→ 更新NPC数据
□ 是否触发支线任务？                                  → story/side_quests/支线任务详情.md
□ 关键对话记录到会话日志
```

---

## F. 休息清单（玩家选择休息时）

```
□ 评估当前位置安全等级（安全/较安全/危险/极危险）       → rules/01 §7.2
□ 告知玩家安全状况和预期恢复量
□ 玩家确认休息时长后：
   - 1h休息：恢复CON点HP + WIL点SP + (CON+STR)点EP
   - 4h+睡眠：恢复50%最大HP/SP/EP
   - 进食饮水：额外+10HP+5EP
□ 投遭遇概率骰（按安全等级：0%/10%/30%/60%）
□ 如果遭遇触发→中断休息→只恢复已完成时间比例的数值
□ 更新饥饿计时（距上次进食累计时间）
□ 更新口渴计时（距上次饮水累计时间）
□ 感染者：休息期间是否到了感染检定时间？（潜伏期每6h）  → rules/01 §4.5
□ 更新角色卡和系统日志
```

---

## G. 场景切换清单（进入新区域时）

```
□ 读取新场景文件                                      → scenes/ 对应目录
□ 投随机事件骰                                        → story/events/随机事件表.md
□ 该区域是否有特殊环境规则？
   - 隧道：黑暗（无光源全检定-20）、噪音×2、潜行-5
   - 地面白天/夜晚：昼夜系统（夜晚遭遇×2）
   - 西区：空气污染（每1h CON检定，无防护-3HP）
   - 实验室：门禁系统、安保机器人
□ 推进移动时间（相邻5-15分 / 长距离30-60分）
□ 是否需要方向/求生检定？（隧道分叉等）
□ 光照条件变化？→ 手电筒电池计时（4小时）
□ 描述新场景时覆盖：视觉、听觉、嗅觉、温度
□ 更新探索日志
```

---

## H. 存档清单（会话结束/玩家请求存档时）

```
□ 队伍角色卡是否已更新到最新状态？（多人局逐张确认）
□ 所有日志是否已写入？（会话/战斗/探索/系统）
□ 创建存档文件 saves/save_YYYYMMDD_HHMMSS_[主角色串]_[AI超简评].md
  - 主角色串示例：赵雨桐+林立
  - AI超简评示例：隧道推进_补给偏紧（建议<=20字）
□ 运行标准封存命令：
  python saves/save_manager.py archive -c [campaign_id] --main-roles "[主角色串]" --ai-blip "[AI超简评]" --note "[会话摘要]"
□ 存档中是否填写了"活跃状态提醒"？
   - 当前持续效果（中毒/流血/感染等级...）
   - 距下次饥饿/口渴检定的剩余时间
   - 当前区域特殊规则
   - 未结算的NPC承诺/任务时限
□ 向玩家展示会话摘要
□ 系统日志记录 [存档] 条目
```

---

## I. 会话开始清单（每次新会话）

```
□ 读取 rules/00_规则速查索引.md（本索引应始终在上下文中）
□ 如需继续旧局，先运行：
  - 已知战役ID：python saves/save_manager.py restore -c [campaign_id] [--snapshot 快照ID]
  - 未知战役ID：python saves/save_manager.py list → 仅1个战役则自动恢复；多个战役先向玩家确认
□ 读取最新存档 saves/
□ 读取角色卡 characters/active/
□ 检查存档中的"活跃状态提醒"→恢复所有计时和持续效果
□ 读取当前位置对应的场景文件
□ 检查是否有可用骰池→如果没有，提醒玩家运行 python tools/dice_pool.py -o 生成
□ 向玩家简述上次进展和当前状态
□ 确认当前主线/支线任务目标
```
