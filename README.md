# 《末日地铁：无限》

一个通过 AI 本地读写文件驱动的 TRPG（桌上角色扮演游戏）。AI 同时担任 DM（游戏主持人）和游戏系统，玩家通过自然语言与 AI 对话来进行游戏。所有游戏状态以 Markdown 文件的形式存储在本地。

---

## 这个项目是什么

这不是一个程序，没有代码需要运行。它是一套**结构化的游戏规则、场景、角色模板和 AI 指令文件**，放在一个文件夹里。你把这个文件夹给一个能读写本地文件的 AI（如 Cursor、Codex、Claude 等），AI 就能作为 DM 来主持这个游戏。

**游戏设定：** 现代都市，丧尸爆发第7天。你是一名困在地铁站避难所里的幸存者。消息传来：城市另一端的实验室有血清。你的目标——活着穿越整座城市，到达实验室最深处。

**游戏特色：** 无限流风格，包容性强。角色可以拥有各种异能（念动力、体表硬化、电击等），使用从小刀到霰弹枪的各种武器，面对从普通行尸到 Boss 级实验体的各种敌人。

---

## 两个角色：玩家做什么，AI 做什么

### 玩家的职责

你只需要做一件事：**用自然语言告诉 AI 你想做什么。**

```
"我搜索这个房间"
"我用消防斧砍那只丧尸"
"我和老陈聊聊关于隧道的情况"
"我想休息一下"
"我使用肾上腺素爆发，然后冲上去攻击"
```

你不需要记住任何规则——AI 会处理所有检定、计算和判定。你只需要做决定。

你也可以随时说：
- **"查看状态"** — AI 会展示你的 HP/SP/EP、背包、位置等
- **"查看日志"** — AI 会展示最近发生的事情
- **"存档"** — AI 会保存当前进度
- **"查看规则"** — AI 会解释相关规则

### AI（DM）的职责

AI 在游戏中扮演四个角色：

**1. 世界叙述者**
描述你所在的场景、你看到/听到/闻到的一切、NPC 的反应和对话。用沉浸式的文学风格，营造末日恐怖氛围。

**2. 规则裁决者**
当你的行动需要判定成败时（搜索、战斗、说服、潜行……），AI 按照规则书执行骰子检定并计算结果。所有投骰过程和数值计算公开透明展示。

**3. 文件管理者**
AI 实时读写本地文件：
- 读取场景描述、敌人数据、NPC 信息来提供内容
- 更新你的角色卡（HP、物品、经验等）
- 写入四种日志记录游戏过程
- 在你存档时保存完整的游戏状态

**4. 节奏控制者**
控制游戏的紧张和舒缓节奏，根据你的进度推进剧情，管理随机事件，调控难度曲线。

---

## 游戏流程：一局游戏是怎么进行的

```
┌──────────────────────────────────────────────────────────┐
│ 1. 启动：给 AI 发送 DM 提示词（见下方"如何开始"）          │
│ 2. 创建角色：选择职业 → 分配属性 → 选异能 → AI 生成角色卡  │
│ 3. 进入游戏：AI 描述开场场景（东华路地铁站避难所）          │
│                                                          │
│ 4. 游戏循环（反复进行）：                                  │
│    ┌──────────────────────────────────────────┐           │
│    │  AI 描述当前场景和状况                     │           │
│    │        ↓                                  │           │
│    │  你说出你想做的事                          │           │
│    │        ↓                                  │           │
│    │  AI 判定行动类型：                         │           │
│    │  · 自由行动（对话/观察）→ 直接描述结果      │           │
│    │  · 技能行动（搜索/撬锁）→ 投骰检定后描述   │           │
│    │  · 战斗行动（攻击敌人）→ 进入回合制战斗    │           │
│    │  · 系统操作（查看状态）→ 展示信息          │           │
│    │        ↓                                  │           │
│    │  AI 描述结果 + 更新文件 + 提供后续选项     │           │
│    └──────────────────────────────────────────┘           │
│                                                          │
│ 5. 存档：你说"存档"或会话结束时 AI 自动保存               │
│ 6. 下次继续：你说"继续游戏"，AI 读取存档恢复               │
└──────────────────────────────────────────────────────────┘
```

### 一个完整回合的例子

```
【AI（DM）】
📍 地铁隧道 - 人民广场站台

昏暗的应急灯在头顶闪烁，红色的光芒照亮了空旷的站台。
几具尸体倒在角落。远处传来断断续续的金属敲击声。
站台西侧有几个影子在缓慢移动。

❓ 你可以...
1. 悄悄靠近查看那些影子
2. 搜索站台东侧
3. 从售票厅那边绕过去
4. 或者自由输入你想做的任何事

【玩家】
我先趴下来，悄悄观察那几个影子是什么

【AI（DM）】
🎭 发生了什么
你压低身体，借助售货机的掩护向西侧望去。

🎲 感知检定
投骰：1d100 = 38
目标值：PER(4)×10 + 搜索(1)×5 = 45
判定：38 ≤ 45 → 成功

你看清了——那是三只行尸，正在站台上漫无目的地游荡。
它们的动作迟缓，似乎还没有注意到你。
距离大约20米。

📊 当前状态
HP: 40/40 | SP: 24/24 | EP: 32/32
位置：人民广场站-站台东侧（掩护中）
威胁：3只行尸（未警觉）

❓ 你可以...
1. 尝试潜行绕过它们
2. 先发制人攻击
3. 制造噪音把它们引走
4. 或其他行动
```

---

## 如何开始

### 前提条件

- 一个能读写本地文件的 AI 工具（Cursor / Codex / 其他支持文件操作的 AI）
- 本项目文件夹放在 AI 可以访问的路径下

### 第一步：启动 AI DM

打开 `dm_guide/快速开始_DM提示词.md`，将里面的提示词复制发送给 AI。

或者直接对 AI 说：

> 你是 TRPG 游戏《末日地铁：无限》的 DM。请依次读取：
> 1. `rules/00_规则速查索引.md`
> 2. `dm_guide/AI_DM指南.md`
> 3. `dm_guide/情境检查清单.md`
>
> 准备好后等待我的指令。

### 第二步：开始游戏

对 AI 说 **"开始新游戏"**，AI 会引导你创建角色。

或者说 **"继续游戏"** 来读取上次的存档。

---

## AI DM 的工作机制

整个系统有 22 个文件、3000+ 行规则。AI 不可能每轮都读取全部内容，所以我们设计了分层机制。

### 核心：每轮工作表（`dm_guide/DM每轮工作表.md`）

这是 AI DM 的硬性行动指南。**每次收到玩家消息，AI 从第1步执行到第7步**：

```
第1步：读懂意图 — 玩家想做什么？可行吗？
第2步：分类行动 — 自由/技能/战斗/系统，走对应分支
第3步：执行处理 — 投骰、检定、计算伤害、应用效果
第4步：推进世界 — 推进时间，检查饥饿/口渴/感染/随机事件
第5步：更新文件 — 角色卡、四种日志、主线进度
第6步：组织输出 — 叙事描述+检定结果+状态变化+后续选项
第7步：验收清单 — 逐条确认全部通过后才发出回复
```

第7步的验收清单覆盖五个维度：规则正确性、遗漏检查（感染/耐久/异能/噪音/状态）、时间与生存、文件更新、输出完整性。任何一条不通过就回到对应步骤修正。

### 辅助层：规则速查索引（`rules/00_规则速查索引.md`）

63 行的精简文件，浓缩了所有核心公式（命中、伤害、衍生数值、难度表、感染、生存……）。AI 在会话开始时读入并始终保持在记忆中。还包含"什么情况读什么文件"的指引表。

### 辅助层：情境检查清单（`dm_guide/情境检查清单.md`）

按操作场景分类的补充提醒列表（战斗进入/战斗每轮/探索/NPC/休息/场景切换/存档/开始），在工作表验收时参考。

### 辅助层：存档状态提醒

存档文件中嵌入了"活跃状态提醒"区域，记录持续效果、计时器和区域特殊规则。读档时立即恢复。

### 当 AI 遗漏规则时

你可以直接提醒它：
- "你好像忘了做感染检定" → AI 会重新查阅规则并补做
- "重新执行验收清单" → AI 会重新过一遍第7步
- "重新加载工作表" → AI 会重新读取工作表文件

---

## 游戏中你会看到的日志

游戏会自动生成四种日志，你可以随时查看：

| 日志类型 | 位置 | 内容 | 风格 |
|----------|------|------|------|
| 会话日志 | `logs/session/` | 完整的冒险故事 | 叙事体，像小说 |
| 战斗日志 | `logs/combat/` | 每轮检定、伤害、状态 | 数据表格化 |
| 探索日志 | `logs/exploration/` | 探索的区域、发现的物品 | 清单式 |
| 系统日志 | `logs/system/` | 所有投骰和数值变动 | 逐行记录 |

---

## 规则体系概要

> 完整规则见 `rules/01_核心规则书.md`，以下是核心要点。

**六大属性：** 力量STR / 敏捷AGI / 体质CON / 感知PER / 智力INT / 意志WIL

**核心判定：** 投 1d100，≤ (属性×10 + 技能等级×5 + 难度修正) 即成功

**三大资源：**
- HP（生命值）= CON×5+10 — 降至0濒死，-10死亡
- SP（精神值）= WIL×4+INT×2 — 使用异能消耗
- EP（耐力值）= CON×3+STR×2 — 体力活动消耗

**战斗：** 回合制，每轮6秒。每人1个主要行动+1个次要行动+自由移动

**感染：** 被丧尸命中后需检定，失败则感染值+1。感染值到10角色变为丧尸

**生存：** 需要管理食物、水、休息。饥饿和口渴会持续削弱角色

**异能：** 12种异能可选，各3级。消耗SP，是末日中的超常战力

**装备：** 有耐久度系统，武器会损坏。噪音大的武器会吸引丧尸

---

## 项目文件结构

```
trpg_table/
│
├── README.md                       ← 你在这里：项目总说明
├── 开始游戏.md                     ← 玩家操作指南和生存提示
│
├── rules/                          ← 游戏规则
│   ├── 00_规则速查索引.md           ← AI 每次会话必读的精简公式卡
│   ├── 01_核心规则书.md             ← 完整规则（属性/战斗/装备/异能/生存/成长）
│   └── 02_TRPG元规则.md             ← DM 裁决流程、输出格式、日志协议
│
├── dm_guide/                       ← AI DM 的操作指南
│   ├── DM每轮工作表.md             ← 【核心】AI 每次收到消息后的7步执行流程+验收清单
│   ├── AI_DM指南.md                ← DM 的身份、原则、氛围技巧、文件规范
│   ├── 情境检查清单.md              ← 按场景分类的补充提醒清单
│   └── 快速开始_DM提示词.md         ← 复制给 AI 即可启动的提示词
│
├── characters/                     ← 角色管理
│   ├── templates/                  ← 空白角色卡模板 + 创建指南（含11种职业）
│   └── active/                     ← 当前游戏中的角色卡
│
├── story/                          ← 剧情内容
│   ├── main_plot/主线剧情框架.md    ← 序章→四章→终章，含3个结局
│   ├── side_quests/支线任务详情.md   ← 8个支线任务
│   └── events/随机事件表.md         ← 按章节分类的随机事件
│
├── scenes/                         ← 场景描述（AI 进入区域时读取）
│   ├── subway/                     ← 地铁站和隧道
│   ├── surface/                    ← 城市地面和西区废墟
│   ├── laboratory/                 ← 终章实验室（含 Boss 战）
│   └── special/                    ← 特殊场景
│
├── assets/                         ← 游戏数据资源
│   ├── enemies/丧尸图鉴.md          ← 10种敌人数据+遭遇生成表
│   ├── items/物品与掉落表.md        ← 5套区域掉落表+制作系统
│   ├── npcs/NPC模板与列表.md        ← 7个关键NPC+好感度系统
│   └── abilities/                  ← 异能详细数据
│
├── logs/                           ← 游戏日志（AI 自动写入）
│   ├── session/                    ← 会话日志（叙事记录）
│   ├── combat/                     ← 战斗日志（数据详情）
│   ├── exploration/                ← 探索日志（发现清单）
│   ├── system/                     ← 系统日志（所有数值变动）
│   └── 日志系统说明.md
│
└── saves/                          ← 存档（含活跃状态提醒）
    └── save_initial_template.md    ← 存档格式模板
```

---

## 常见问题

**Q：AI 可以公平地投骰吗？**
A：AI 模拟随机数。所有投骰过程和计算公开展示，你可以验证。如果你不信任 AI 的随机性，可以自己用骰子工具投，把结果告诉 AI。

**Q：一次会话要多久？**
A：取决于你。可以玩20分钟做一次探索，也可以玩几个小时推进一整章。存档系统让你随时中断和继续。

**Q：可以多人游戏吗？**
A：目前设计为单人游戏。但可以多人共用一个对话窗口，轮流声明行动。

**Q：角色死了怎么办？**
A：感染值到10或HP到-10，角色死亡。可以读取之前的存档重来，或者创建新角色从当前进度点继续。

**Q：可以自定义规则/场景吗？**
A：当然可以。所有内容都是 Markdown 文件，直接编辑即可。你可以加新的异能、敌人、场景、支线任务。
