# 日志系统说明

## 日志架构

本系统维护四种并行日志，从不同维度记录游戏过程。每种日志服务于不同的需求。

---

## 一、会话日志 (`logs/session/`)

### 用途
完整的叙事记录，像一部连续的小说。玩家可以回顾整个冒险故事。

### 格式

```markdown
# 会话日志 #[编号]
**日期**：[现实日期]
**游戏内时间**：[起始时间] → [结束时间]
**角色**：[角色名]
**位置**：[起始位置] → [结束位置]

---

## 回顾

[简要回顾上次会话的结尾状况，1-2句话]

---

## 本次冒险

### [时间段1]

[叙事描述，包含环境、行动、对话、事件]

[如果有战斗，简要描述战斗过程和结果]

[如果有NPC交互，记录关键对话]

### [时间段2]

[继续叙事...]

---

## 本次摘要

- **主要事件**：[列表]
- **获得物品**：[列表]
- **失去物品**：[列表]
- **状态变化**：[HP/SP/EP变化、负面状态等]
- **进度更新**：[主线/支线任务进度]
- **下次开始位置**：[位置名]
```

### 写入时机
- 每个场景切换
- 重要对话后
- 战斗结束后
- 会话结束时生成完整日志

---

## 二、战斗日志 (`logs/combat/`)

### 用途
详细的战斗数据记录，所有检定、伤害计算、状态变化一目了然。用于复盘战斗和验证数据。

### 格式

```markdown
# 战斗日志 #[编号]
**日期**：[现实日期]
**游戏内时间**：[战斗发生时间]
**地点**：[战斗地点]
**参战方**：[玩家方] vs [敌方列表]

---

## 战前状态

| 单位 | HP | SP | EP | 状态 | 武器 |
|------|-----|-----|-----|------|------|
| [角色名] | XX/XX | XX/XX | XX/XX | 正常 | [武器] |
| [敌人名] | XX | - | - | - | - |

## 先攻投骰

| 单位 | AGI | PER | 1d100→1d10 | 先攻值 |
|------|-----|-----|-------|--------|
| [角色] | X | X | X | XX |
| [敌人] | X | X | X | XX |

**行动顺序**：[排序]

---

## 第1轮

### [角色名] 的行动
- **声明**：[玩家声明的行动]
- **行动类型**：[主要行动/次要行动]
- **检定**：[属性]×10 + [技能]×5 = [基础值]，难度修正[±X]
- **投骰**：1d100 = [结果] vs 目标值 [X]
- **结果**：[成功/失败/大成功/大失败]
- **伤害**（如有）：[武器骰] = [结果] + [修正] - 护甲[X] = **[最终伤害]**
- **效果**：[描述]

### [敌人名] 的行动
- **行为**：[AI决定的行动]
- **检定**：...
- **投骰**：...
- **结果**：...

### 第1轮结束状态
| 单位 | HP | 状态变化 |
|------|-----|---------|
| ... | ... | ... |

---

## 第2轮
[重复格式...]

---

## 战斗结果

- **胜利方**：[谁赢了]
- **持续轮数**：[X轮]
- **角色最终状态**：HP [X/X], SP [X/X], EP [X/X]
- **击杀**：[击杀列表]
- **经验获得**：[总经验值]
- **战利品**：[掉落物品列表]
- **负面状态**：[战斗中获得的负面状态]
```

### 写入时机
- 战斗开始时创建
- 每轮结束时更新
- 战斗结束时完成

---

## 三、探索日志 (`logs/exploration/`)

### 用途
记录探索过的区域、发现的物品、遇到的NPC和获得的信息。类似于冒险者的笔记本。

### 格式

```markdown
# 探索日志 #[编号]
**日期**：[现实日期]
**游戏内时间**：[时间段]
**探索区域**：[区域名称]

---

## 已探索区域

### [区域名1]
- **发现时间**：[游戏内时间]
- **安全等级**：[安全/警戒/危险/极危险]
- **发现物品**：
  - [物品1] ×[数量]
  - [物品2] ×[数量]
- **遇到NPC**：
  - [NPC名]：[简述交互]
- **重要信息**：
  - [信息1]
  - [信息2]
- **未探索部分**：
  - [描述尚未探索的区域]
- **备注**：[玩家或DM的笔记]

### [区域名2]
[重复格式...]

---

## 物资汇总

| 物品 | 获得 | 消耗 | 当前持有 |
|------|------|------|----------|
| ... | ... | ... | ... |

## 信息汇总

| 来源 | 信息内容 | 可信度 |
|------|----------|--------|
| ... | ... | 高/中/低 |
```

### 写入时机
- 进入新区域时
- 完成搜索后
- NPC交互获取信息后
- 发现重要线索时

---

## 四、系统日志 (`logs/system/`)

### 用途
纯数据日志，记录所有数值变动和检定结果。这是最"机械"的日志，用于数据追踪和审计。

### 格式

```markdown
# 系统日志 [日期]

## 格式说明
每行一条记录：[游戏内时间] [类型] [详细内容]

---

[08:30] [检定] 角色:李明 类型:搜索(PER) 基础值:55 修正:+0 投骰:1d100=42 结果:成功
[08:30] [物品+] 角色:李明 获得:瓶装水×2 来源:搜索地铁站台
[08:35] [移动] 角色:李明 从:站台层 到:维修室
[08:40] [检定] 角色:李明 类型:锁技(AGI/INT) 基础值:45 修正:-10 投骰:1d100=62 结果:失败
[08:42] [检定] 角色:李明 类型:锁技(AGI/INT) 基础值:45 修正:-10 投骰:1d100=28 结果:成功
[08:42] [物品+] 角色:李明 获得:撬棍×1, 手电筒×1 来源:维修室工具柜
[09:00] [战斗开始] 地点:隧道入口 敌人:行尸×2
[09:00] [先攻] 李明:15 行尸A:8 行尸B:6
[09:00] [攻击] 李明→行尸A 近战格斗 基础值:65 投骰:34 命中 伤害:1d8=6+2(STR)-0(护甲)=8
[09:00] [HP变化] 行尸A HP:15→7
[09:00] [攻击] 行尸A→李明 爪击 基础值:40 投骰:55 未命中
[09:00] [攻击] 行尸B→李明 爪击 基础值:40 投骰:23 命中
[09:00] [闪避] 李明 基础值:50 投骰:38 成功(闪避)
[09:01] [攻击] 李明→行尸A 近战格斗 基础值:65 投骰:12 命中 伤害:1d8=7+2=9
[09:01] [HP变化] 行尸A HP:7→0 击杀
[09:01] [经验+] 角色:李明 +5 (击杀行尸) 总计:5
...
[09:05] [战斗结束] 结果:胜利 用时:3轮
[09:05] [HP变化] 角色:李明 HP:45→40 (战斗消耗)
[09:05] [EP变化] 角色:李明 EP:28→22 (战斗消耗)
[09:10] [状态] 角色:李明 获得:轻微疲劳
[10:00] [生存] 饥饿检查：距上次进食6小时 状态:正常
[10:00] [生存] 口渴检查：距上次饮水4小时 状态:正常
```

### 标签类型

| 标签 | 含义 |
|------|------|
| [检定] | 技能/属性检定 |
| [暗骰] | DM暗中进行的检定 |
| [攻击] | 攻击行动 |
| [闪避] | 闪避/格挡行动 |
| [HP变化] | 生命值变化 |
| [SP变化] | 精神值变化 |
| [EP变化] | 耐力值变化 |
| [物品+] | 获得物品 |
| [物品-] | 失去/使用物品 |
| [移动] | 位置变更 |
| [战斗开始] | 战斗开始 |
| [战斗结束] | 战斗结束 |
| [先攻] | 先攻投骰 |
| [经验+] | 获得经验 |
| [升级] | 角色升级 |
| [异能] | 异能使用 |
| [状态] | 状态变化 |
| [感染] | 感染相关 |
| [生存] | 饥饿/口渴/休息 |
| [事件] | 特殊事件触发 |
| [NPC] | NPC交互记录 |
| [存档] | 存档操作 |
| **[DM工作记录]** | **每轮验收通过后的完整工作记录** |

### 写入时机
- **实时记录**：每次检定、每次数值变化、每次物品变动都应记录
- **[DM工作记录]**：每轮验收通过后，按 `dm_guide/DM每轮工作表.md` 附录B的格式追加
- 这是最频繁更新的日志

---

## 日志查看指令

玩家可以在游戏中通过以下方式查看日志：

| 指令 | 效果 |
|------|------|
| "查看冒险日志" | 显示最近的会话日志摘要 |
| "查看战斗记录" | 显示最近的战斗详情 |
| "查看探索笔记" | 显示已探索区域和发现 |
| "查看状态变化" | 显示最近的系统日志 |
| "查看所有日志" | 显示所有日志的摘要 |
| "查看[物品]记录" | 搜索特定物品的获取/使用记录 |
